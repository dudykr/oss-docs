# Contributing

## Configuring development environment

1. Clone stc.
2. Run `yarn` in the cloned directory.
3. (mac only) Install `zld`

```sh
brew install michaeleisel/zld/zld
```

## Project structure

### crates/stc_ts_file_analyzer

#### tests/pass-only

#### tests/pass

#### tests/errors

#### tests/visualize

### crates/stc_ts_type_checker

## Debugging tips

### Debugging with vscode Debugger

Please copy `.vscode/launch.template.json` and rename it to `.vscode/launch.json`.

In `launch.json`, you can pass the path of the `.ts` file you want to check to the `args` field.
Then, you can run the type checker with debugger from the debugger panel.

### `print_backtrace()`

If you think some code should not be invoked but seems like it's invoked, you can use `print_backtrace()`.
It will print the stack trace of the current thread.
Note that it will automatically exclude useless items from the stack trace.

### Matching over `Type`

To avoid performance drop caused by cloning, `stc` uses `Type::Arc` to share memory.
But there's a downside for this - you have to call `normalize()` while matching.

e.g.

```rust
match ty.normalize() {
}
```

Note that this is different from `self.normalize(ty)` of `Analyzer`, which is used to expand special types like references, queries, mapped, etc..

### Finding problematic code

Look at the `context:` in the error output, and search it from repository using substring of the context.
e.g. `tried to assign to a template type` means the error comes from [crates/stc_ts_file_analyzer/src/analyzer/assign/mod.rs#L2208](https://github.com/dudykr/stc/blob/1c73ce5fa87ec789ead108c5c6876e8089b1e5de/crates/stc_ts_file_analyzer/src/analyzer/assign/mod.rs#L2208)

## Troubleshooting

### Windows - `unstable on this platform`

In case if you're using Windows and getting an error

```sh
error: `-Csplit-debuginfo=unpacked` is unstable on this platform
```

as a workaround you can try using [WSL](https://learn.microsoft.com/en-us/windows/wsl/).

### `failed to execute command`

If you're getting something like

```sh
--- stderr
  thread 'main' panicked at 'failed to execute command: No such file or directory (os error 2)', /home/ubuntu/.cargo/registry/src/github.com-1ecc6299db9ec823/tikv-jemalloc-sys-0.5.2+5.3.0-patched/build.rs:326:19
```

try running `apt-get install make`. ([related issue](https://github.com/gnzlbg/jemallocator/issues/148#issuecomment-619373613))
